<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIU Financial Dashboard - All Years</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            font-weight: 300;
        }

        .header .last-updated {
            color: #95a5a6;
            font-size: 0.9rem;
            font-weight: 400;
            margin-top: 8px;
            font-style: italic;
        }

        /* Year Selector Styles */
        .year-selector {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .year-selector-title {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .year-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .year-btn {
            background: white;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .year-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: #f8f9fa;
        }

        .year-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .year-btn.loading {
            opacity: 0.6;
            cursor: wait;
        }

        .alert-banner {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .alert-banner h3 {
            color: #155724;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .alert-banner p {
            color: #155724;
            margin: 0;
            font-weight: 500;
        }

        .semester-section {
            margin-bottom: 50px;
            padding-bottom: 40px;
            border-bottom: 2px solid #e9ecef;
        }

        .semester-section:last-child {
            border-bottom: none;
            margin-bottom: 30px;
        }

        .semester-header {
            background: linear-gradient(to right, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 6px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .semester-header h2 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin: 0;
        }

        .performance-badge {
            display: flex;
            gap: 15px;
        }

        .badge-item {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .badge-item.good {
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .badge-item.warning {
            color: #f39c12;
            border: 1px solid #f39c12;
        }

        .badge-item.poor {
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .semester-metrics {
            margin-bottom: 30px;
        }

        .currency-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-3px);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #3498db;
        }

        .metric-card.lusd::before {
            background: #3498db;
        }

        .metric-card.cusd::before {
            background: #9b59b6;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .metric-title {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
        }

        .currency-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .currency-badge.lusd {
            background: #e3f2fd;
            color: #1976d2;
        }

        .currency-badge.cusd {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-subtitle {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .metric-conversion {
            font-size: 0.9rem;
            color: #2980b9;
            font-weight: 600;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e3f2fd;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-fill.good {
            background: #27ae60;
        }

        .progress-fill.warning {
            background: #f39c12;
        }

        .progress-fill.poor {
            background: #e74c3c;
        }

        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid;
            transition: transform 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-card.revenue { border-color: #9b59b6; }
        .kpi-card.fa { border-color: #e74c3c; }
        .kpi-card.collections { border-color: #27ae60; }
        .kpi-card.outstanding { border-color: #f39c12; }
        .kpi-card.expenses { border-color: #e67e22; }
        .kpi-card.result { border-color: #16a085; }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .kpi-title {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .kpi-icon.revenue { background: #9b59b6; }
        .kpi-icon.fa { background: #e74c3c; }
        .kpi-icon.collections { background: #27ae60; }
        .kpi-icon.outstanding { background: #f39c12; }
        .kpi-icon.expenses { background: #e67e22; }
        .kpi-icon.result { background: #16a085; }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .kpi-value.positive {
            color: #27ae60;
        }

        .kpi-value.negative {
            color: #e74c3c;
        }

        .kpi-change {
            font-size: 0.9rem;
            font-weight: 500;
            color: #7f8c8d;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .waterfall-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 0.85rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 2px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .data-table .number {
            text-align: right;
        }

        .positive { color: #27ae60; font-weight: 600; }
        .negative { color: #e74c3c; font-weight: 600; }

        .error-message {
            background: #fee;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #c0392b;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }

            .kpi-section {
                grid-template-columns: 1fr;
            }

            .currency-row {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .year-buttons {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>LIU Financial Dashboard</h1>
            <p class="subtitle">Comprehensive Financial Performance Analysis â€¢ All Academic Years</p>
            <p class="last-updated">Last updated: February 19, 2026</p>
        </div>

        <!-- View Selector -->
        <div style="background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); border-radius: 15px; padding: 20px; margin-bottom: 25px; box-shadow: 0 10px 25px rgba(44, 62, 80, 0.3);">
            <div style="display: flex; justify-content: center; gap: 20px;">
                <button id="dashboardViewBtn" class="view-btn active" onclick="switchView('dashboard')" style="background: white; border: 2px solid white; border-radius: 10px; padding: 12px 30px; font-size: 1rem; font-weight: 600; color: #2c3e50; cursor: pointer; transition: all 0.3s ease; min-width: 150px;">
                    ðŸ“Š Dashboard
                </button>
                <button id="graphsViewBtn" class="view-btn" onclick="switchView('graphs')" style="background: transparent; border: 2px solid white; border-radius: 10px; padding: 12px 30px; font-size: 1rem; font-weight: 600; color: white; cursor: pointer; transition: all 0.3s ease; min-width: 150px;">
                    ðŸ“ˆ Trend Analysis
                </button>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView">
            <!-- Year Selector -->
            <div class="year-selector">
                <div class="year-selector-title">ðŸ“Š Select Academic Year</div>
                <div class="year-buttons" id="yearButtons">
                    <!-- Year buttons will be populated here -->
                </div>
            </div>

        <!-- Main Content Container -->
        <div id="mainContent" style="display: none;">
            <!-- Financial Alert -->
            <div class="alert-banner" id="alertBanner">
                <h3 id="alertTitle">Select a year to view financial data</h3>
                <p id="alertText">Choose from available academic years above</p>
            </div>

            <!-- Currency Conversion Note -->
            <div id="currencyNote" style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 30px; text-align: center; display: none;">
                <h4 style="color: #856404; margin-bottom: 5px; font-size: 1.1rem;">ðŸ“Š Currency Conversion Note</h4>
                <p style="color: #856404; margin: 0; font-weight: 500;">LUSD amounts are displayed in original currency with USD conversion shown below<br>Conversion rate: <span id="conversionRate">LUSD Ã— Exchange Rate Ã· 89,700 = USD</span></p>
            </div>

            <!-- Overall KPIs -->
            <div class="kpi-section" id="kpiSection">
                <!-- KPI cards will be populated here -->
            </div>

            <!-- Reserves Section -->
            <div id="reservesSection" style="display: none;">
                <div style="margin: 40px 0 30px 0;">
                    <h2 style="text-align: center; color: #2c3e50; font-size: 2rem; margin-bottom: 30px;">Cash Reserves by Semester</h2>
                </div>
                <div class="kpi-section" id="reservesKpiSection" style="margin-bottom: 30px;">
                    <!-- Reserves KPI cards will be populated here -->
                </div>
                <div id="reservesMonthlyComparison" style="display: none;">
                    <!-- Monthly comparison table will be populated here -->
                </div>
            </div>

            <!-- Semester Sections -->
            <div style="margin: 40px 0 30px 0;">
                <h2 style="text-align: center; color: #2c3e50; font-size: 2rem; margin-bottom: 10px;">Semester Performance Details</h2>
                <p style="text-align: center; color: #7f8c8d; font-size: 1.1rem; margin-bottom: 30px;">Financial metrics breakdown by semester with collection performance</p>
            </div>
            <div id="semesterSections"></div>

            <!-- Charts Section -->
            <div class="charts-section" id="chartsSection">
                <!-- Charts will be populated here -->
            </div>

            <!-- Summary Table -->
            <div class="chart-card" id="summaryTableCard">
                <h3 class="chart-title">Financial Summary</h3>
                <table class="data-table" id="summaryTable">
                    <!-- Table will be populated here -->
                </table>
            </div>
        </div>
        </div><!-- End Dashboard View -->

        <!-- Graphs View -->
        <div id="graphsView" style="display: none;">
            <div style="margin: 40px 0 30px 0;">
                <h2 style="text-align: center; color: #2c3e50; font-size: 2.5rem; margin-bottom: 10px;">ðŸ“ˆ Historical Trend Analysis</h2>
                <p style="text-align: center; color: #7f8c8d; font-size: 1.3rem; margin-bottom: 30px;">Financial metrics and student enrollment trends across all academic years</p>
            </div>
            <div id="graphsSection" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                <!-- Line charts will be populated here -->
            </div>
        </div><!-- End Graphs View -->
    </div>

    <script>
        // Hardcoded data embedded directly in the HTML
const HARDCODED_DATA = {
  "2025-2026": {
    "year": "2025-2026",
    "semesters": {
      "Spring_2025_2026": {
        "semester": "Spring_2025_2026",
        "students": 20894.0,
        "students_excluding_drop": 20740.0,
        "total_paid_lusd": 52167.0,
        "total_unpaid_lusd": 5943183.0,
        "total_paid_percent_lusd": 0.87,
        "total_paid_cusd": 336035.0,
        "total_unpaid_cusd": 33084637.0,
        "total_paid_percent_cusd": 1.01,
        "fa_amounts": 18268814.61,
        "before_fa": 57684836.61,
        "total_expected_revenue_lusd": 5995350.0,
        "total_expected_revenue_cusd": 33420672.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 1939817.0,
              "collected": 40150.0,
              "outstanding": 1899667.0,
              "percent": 2.07
            },
            {
              "name": "V2",
              "expected": 1551458.0,
              "collected": 6181.0,
              "outstanding": 1545277.0,
              "percent": 0.4
            },
            {
              "name": "V3",
              "expected": 1240802.0,
              "collected": 3111.0,
              "outstanding": 1237691.0,
              "percent": 0.25
            },
            {
              "name": "V4",
              "expected": 1261717.0,
              "collected": 2725.0,
              "outstanding": 1258992.0,
              "percent": 0.22
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9877505.0,
              "collected": 252525.0,
              "outstanding": 9624980.0,
              "percent": 2.56
            },
            {
              "name": "V2",
              "expected": 7702616.0,
              "collected": 44045.0,
              "outstanding": 7658571.0,
              "percent": 0.57
            },
            {
              "name": "V3",
              "expected": 7663105.0,
              "collected": 21670.0,
              "outstanding": 7641435.0,
              "percent": 0.28
            },
            {
              "name": "V4",
              "expected": 7969277.0,
              "collected": 17525.0,
              "outstanding": 7951752.0,
              "percent": 0.22
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2025_2026": {
        "semester": "Fall_2025_2026",
        "students": 24884.0,
        "students_excluding_drop": 24328.0,
        "total_paid_lusd": 5071540.0,
        "total_unpaid_lusd": 1866217.0,
        "total_paid_percent_lusd": 73.1,
        "total_paid_cusd": 29166252.0,
        "total_unpaid_cusd": 9473067.0,
        "total_paid_percent_cusd": 75.48,
        "fa_amounts": 21917015.07,
        "before_fa": 67494091.07,
        "total_expected_revenue_lusd": 6937757.0,
        "total_expected_revenue_cusd": 38639319.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 2723622.0,
              "collected": 2133167.0,
              "outstanding": 590455.0,
              "percent": 78.32
            },
            {
              "name": "V2",
              "expected": 1699050.0,
              "collected": 1258336.0,
              "outstanding": 440714.0,
              "percent": 74.06
            },
            {
              "name": "V3",
              "expected": 1284888.0,
              "collected": 889612.0,
              "outstanding": 395276.0,
              "percent": 69.24
            },
            {
              "name": "V4",
              "expected": 1210444.0,
              "collected": 781039.0,
              "outstanding": 429405.0,
              "percent": 64.53
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 10703818.0,
              "collected": 8504625.0,
              "outstanding": 2199193.0,
              "percent": 79.45
            },
            {
              "name": "V2",
              "expected": 9284969.0,
              "collected": 7233069.0,
              "outstanding": 2051900.0,
              "percent": 77.9
            },
            {
              "name": "V3",
              "expected": 8483082.0,
              "collected": 6315241.0,
              "outstanding": 2167841.0,
              "percent": 74.45
            },
            {
              "name": "V4",
              "expected": 8224449.0,
              "collected": 5767765.0,
              "outstanding": 2456684.0,
              "percent": 70.13
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 125178927.67999999,
      "financial_aid": 40185829.68,
      "gross_after_fa": 84993098.0,
      "net_revenue": 32358310.96878484,
      "collections": 32358310.96878484,
      "outstanding": 46910769.774804905,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [
        {
          "month": "October",
          "amount": 4396510.68115942,
          "semester": "Fall"
        },
        {
          "month": "November",
          "amount": 3000806.066889632,
          "semester": "Fall"
        },
        {
          "month": "December",
          "amount": 1114209.1415830546,
          "semester": "Fall"
        },
        {
          "month": "January",
          "amount": 5879460.440356744,
          "semester": "Fall"
        },
        {
          "month": "February",
          "amount": 1531402.088071349,
          "semester": "Spring"
        }
      ],
      "by_semester": {
        "Fall": 14390986.329988852,
        "Spring": 1531402.088071349,
        "Summer": 0
      },
      "total": 15922388.418060202,
      "prev_year": {
        "monthly": [
          {
            "month": "October",
            "amount": 1545338.5171131883,
            "semester": "Fall"
          },
          {
            "month": "November",
            "amount": 1460873.7246314704,
            "semester": "Fall"
          },
          {
            "month": "December",
            "amount": 3774687.9130434785,
            "semester": "Fall"
          },
          {
            "month": "January",
            "amount": 7689745.593620466,
            "semester": "Fall"
          },
          {
            "month": "February",
            "amount": 4467591.433667782,
            "semester": "Spring"
          },
          {
            "month": "March",
            "amount": 3016262.562090893,
            "semester": "Spring"
          },
          {
            "month": "April",
            "amount": 2651571.4069119287,
            "semester": "Spring"
          },
          {
            "month": "May",
            "amount": 4609937.712374582,
            "semester": "Spring"
          },
          {
            "month": "June",
            "amount": 2983709.509476031,
            "semester": "Spring"
          },
          {
            "month": "July",
            "amount": 887359.1828316611,
            "semester": "Summer"
          },
          {
            "month": "August",
            "amount": 561318.8405797102,
            "semester": "Summer"
          },
          {
            "month": "September",
            "amount": 4114080.8584169457,
            "semester": "Summer"
          }
        ],
        "by_semester": {
          "Fall": 14470645.748408604,
          "Spring": 17729072.62452122,
          "Summer": 5562758.881828317
        },
        "total": 37762477.254758134
      }
    }
  },
  "2024-2025": {
    "year": "2024-2025",
    "semesters": {
      "Summer_2024_2025": {
        "semester": "Summer_2024_2025",
        "students": 9236.0,
        "students_excluding_drop": 8229.0,
        "total_paid_lusd": 1750352.0,
        "total_unpaid_lusd": 217229.0,
        "total_paid_percent_lusd": 88.96,
        "total_paid_cusd": 4548871.0,
        "total_unpaid_cusd": 635490.0,
        "total_paid_percent_cusd": 87.74,
        "fa_amounts": 2955375.24,
        "before_fa": 10107317.24,
        "total_expected_revenue_lusd": 1967581.0,
        "total_expected_revenue_cusd": 5184361.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 1068813.0,
              "collected": 960498.0,
              "outstanding": 108315.0,
              "percent": 89.87
            },
            {
              "name": "V2",
              "expected": 865151.0,
              "collected": 759987.0,
              "outstanding": 105164.0,
              "percent": 87.84
            },
            {
              "name": "V3",
              "expected": 22843.0,
              "collected": 20120.0,
              "outstanding": 2723.0,
              "percent": 88.08
            },
            {
              "name": "V4",
              "expected": 4408.0,
              "collected": 3381.0,
              "outstanding": 1027.0,
              "percent": 76.7
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2666682.0,
              "collected": 2366453.0,
              "outstanding": 300229.0,
              "percent": 88.74
            },
            {
              "name": "V2",
              "expected": 2381647.0,
              "collected": 2065395.0,
              "outstanding": 316252.0,
              "percent": 86.72
            },
            {
              "name": "V3",
              "expected": 99287.0,
              "collected": 91193.0,
              "outstanding": 8094.0,
              "percent": 91.85
            },
            {
              "name": "V4",
              "expected": 24750.0,
              "collected": 18570.0,
              "outstanding": 6180.0,
              "percent": 75.03
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2024_2025": {
        "semester": "Spring_2024_2025",
        "students": 23542.0,
        "students_excluding_drop": 23264.0,
        "total_paid_lusd": 11696203.0,
        "total_unpaid_lusd": 1926582.0,
        "total_paid_percent_lusd": 85.86,
        "total_paid_cusd": 25595431.0,
        "total_unpaid_cusd": 4204796.0,
        "total_paid_percent_cusd": 85.89,
        "fa_amounts": 21095754.38,
        "before_fa": 64518766.38,
        "total_expected_revenue_lusd": 13622785.0,
        "total_expected_revenue_cusd": 29800227.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 4539069.0,
              "collected": 3974065.0,
              "outstanding": 565004.0,
              "percent": 87.55
            },
            {
              "name": "V2",
              "expected": 3276680.0,
              "collected": 2850293.0,
              "outstanding": 426387.0,
              "percent": 86.99
            },
            {
              "name": "V3",
              "expected": 2888325.0,
              "collected": 2457723.0,
              "outstanding": 430602.0,
              "percent": 85.09
            },
            {
              "name": "V4",
              "expected": 2788809.0,
              "collected": 2290044.0,
              "outstanding": 498765.0,
              "percent": 82.12
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9394441.0,
              "collected": 8238045.0,
              "outstanding": 1156396.0,
              "percent": 87.69
            },
            {
              "name": "V2",
              "expected": 7063264.0,
              "collected": 6120191.0,
              "outstanding": 943073.0,
              "percent": 86.65
            },
            {
              "name": "V3",
              "expected": 6561203.0,
              "collected": 5587811.0,
              "outstanding": 973392.0,
              "percent": 85.16
            },
            {
              "name": "V4",
              "expected": 6363201.0,
              "collected": 5300991.0,
              "outstanding": 1062210.0,
              "percent": 83.31
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2024_2025": {
        "semester": "Fall_2024_2025",
        "students": 26585.0,
        "students_excluding_drop": 24459.0,
        "total_paid_lusd": 12225608.0,
        "total_unpaid_lusd": 2278226.0,
        "total_paid_percent_lusd": 84.29,
        "total_paid_cusd": 26117650.0,
        "total_unpaid_cusd": 4338075.0,
        "total_paid_percent_cusd": 85.76,
        "fa_amounts": 21308715.27,
        "before_fa": 66268274.27,
        "total_expected_revenue_lusd": 14503834.0,
        "total_expected_revenue_cusd": 30455725.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 4829403.0,
              "collected": 4195798.0,
              "outstanding": 633605.0,
              "percent": 86.88
            },
            {
              "name": "V2",
              "expected": 3617641.0,
              "collected": 3084603.0,
              "outstanding": 533038.0,
              "percent": 85.27
            },
            {
              "name": "V3",
              "expected": 3064496.0,
              "collected": 2541257.0,
              "outstanding": 523239.0,
              "percent": 82.93
            },
            {
              "name": "V4",
              "expected": 2864776.0,
              "collected": 2279656.0,
              "outstanding": 585120.0,
              "percent": 79.58
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9008269.0,
              "collected": 7959632.0,
              "outstanding": 1048637.0,
              "percent": 88.36
            },
            {
              "name": "V2",
              "expected": 7432008.0,
              "collected": 6428657.0,
              "outstanding": 1003351.0,
              "percent": 86.5
            },
            {
              "name": "V3",
              "expected": 6584495.0,
              "collected": 5587515.0,
              "outstanding": 996980.0,
              "percent": 84.86
            },
            {
              "name": "V4",
              "expected": 6138328.0,
              "collected": 5129134.0,
              "outstanding": 1009194.0,
              "percent": 83.56
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 140894357.89000002,
      "financial_aid": 45359844.89,
      "gross_after_fa": 95534513.00000001,
      "net_revenue": 70571964.82051283,
      "collections": 70571964.82051283,
      "outstanding": 11643264.567447044,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [
        {
          "month": "October",
          "amount": 1545338.5171131883,
          "semester": "Fall"
        },
        {
          "month": "November",
          "amount": 1460873.7246314704,
          "semester": "Fall"
        },
        {
          "month": "December",
          "amount": 3774687.9130434785,
          "semester": "Fall"
        },
        {
          "month": "January",
          "amount": 7689745.593620466,
          "semester": "Fall"
        },
        {
          "month": "February",
          "amount": 4467591.433667782,
          "semester": "Spring"
        },
        {
          "month": "March",
          "amount": 3016262.562090893,
          "semester": "Spring"
        },
        {
          "month": "April",
          "amount": 2651571.4069119287,
          "semester": "Spring"
        },
        {
          "month": "May",
          "amount": 4609937.712374582,
          "semester": "Spring"
        },
        {
          "month": "June",
          "amount": 2983709.509476031,
          "semester": "Spring"
        },
        {
          "month": "July",
          "amount": 887359.1828316611,
          "semester": "Summer"
        },
        {
          "month": "August",
          "amount": 561318.8405797102,
          "semester": "Summer"
        },
        {
          "month": "September",
          "amount": 4114080.8584169457,
          "semester": "Summer"
        }
      ],
      "by_semester": {
        "Fall": 14470645.748408604,
        "Spring": 17729072.62452122,
        "Summer": 5562758.881828317
      },
      "total": 37762477.254758134
    }
  },
  "2023-2024": {
    "year": "2023-2024",
    "semesters": {
      "Summer_2023_2024": {
        "semester": "Summer_2023_2024",
        "students": 11245.0,
        "students_excluding_drop": 9946.0,
        "total_paid_lusd": 3450577.0,
        "total_unpaid_lusd": 226504.0,
        "total_paid_percent_lusd": 93.84,
        "total_paid_cusd": 4364319.0,
        "total_unpaid_cusd": 341382.0,
        "total_paid_percent_cusd": 92.75,
        "fa_amounts": 3622407.2,
        "before_fa": 12005189.2,
        "total_expected_revenue_lusd": 3677081.0,
        "total_expected_revenue_cusd": 4705701.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 1933375.0,
              "collected": 1823741.0,
              "outstanding": 109634.0,
              "percent": 94.33
            },
            {
              "name": "V2",
              "expected": 1648855.0,
              "collected": 1532707.0,
              "outstanding": 116148.0,
              "percent": 92.96
            },
            {
              "name": "V3",
              "expected": 76046.0,
              "collected": 75324.0,
              "outstanding": 722.0,
              "percent": 99.05
            },
            {
              "name": "V4",
              "expected": 9515.0,
              "collected": 9515.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2511510.0,
              "collected": 2339048.0,
              "outstanding": 172462.0,
              "percent": 93.13
            },
            {
              "name": "V2",
              "expected": 2099606.0,
              "collected": 1935877.0,
              "outstanding": 163729.0,
              "percent": 92.2
            },
            {
              "name": "V3",
              "expected": 73310.0,
              "collected": 70404.0,
              "outstanding": 2906.0,
              "percent": 96.04
            },
            {
              "name": "V4",
              "expected": 9314.0,
              "collected": 9029.0,
              "outstanding": 285.0,
              "percent": 96.94
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2023_2024": {
        "semester": "Spring_2023_2024",
        "students": 25888.0,
        "students_excluding_drop": 25494.0,
        "total_paid_lusd": 20378882.0,
        "total_unpaid_lusd": 1961386.0,
        "total_paid_percent_lusd": 91.22,
        "total_paid_cusd": 21213655.0,
        "total_unpaid_cusd": 2140364.0,
        "total_paid_percent_cusd": 90.84,
        "fa_amounts": 22958171.28,
        "before_fa": 68652458.28,
        "total_expected_revenue_lusd": 22340268.0,
        "total_expected_revenue_cusd": 23354019.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 7245831.0,
              "collected": 6692061.0,
              "outstanding": 553770.0,
              "percent": 92.36
            },
            {
              "name": "V2",
              "expected": 5367278.0,
              "collected": 4909295.0,
              "outstanding": 457983.0,
              "percent": 91.47
            },
            {
              "name": "V3",
              "expected": 4856365.0,
              "collected": 4405054.0,
              "outstanding": 451311.0,
              "percent": 90.71
            },
            {
              "name": "V4",
              "expected": 4703544.0,
              "collected": 4209808.0,
              "outstanding": 493736.0,
              "percent": 89.5
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 7466502.0,
              "collected": 6855781.0,
              "outstanding": 610721.0,
              "percent": 91.82
            },
            {
              "name": "V2",
              "expected": 5619662.0,
              "collected": 5113505.0,
              "outstanding": 506157.0,
              "percent": 90.99
            },
            {
              "name": "V3",
              "expected": 5108120.0,
              "collected": 4620279.0,
              "outstanding": 487841.0,
              "percent": 90.45
            },
            {
              "name": "V4",
              "expected": 4890354.0,
              "collected": 4392730.0,
              "outstanding": 497624.0,
              "percent": 89.82
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2023_2024": {
        "semester": "Fall_2023_2024",
        "students": 29363.0,
        "students_excluding_drop": 28385.0,
        "total_paid_lusd": 22458209.0,
        "total_unpaid_lusd": 2464533.0,
        "total_paid_percent_lusd": 90.11,
        "total_paid_cusd": 23385405.0,
        "total_unpaid_cusd": 2367009.0,
        "total_paid_percent_cusd": 90.81,
        "fa_amounts": 24970257.31,
        "before_fa": 75645413.31,
        "total_expected_revenue_lusd": 24922742.0,
        "total_expected_revenue_cusd": 25752414.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 8506258.0,
              "collected": 7843139.0,
              "outstanding": 663119.0,
              "percent": 92.2
            },
            {
              "name": "V2",
              "expected": 6007122.0,
              "collected": 5409012.0,
              "outstanding": 598110.0,
              "percent": 90.04
            },
            {
              "name": "V3",
              "expected": 5305522.0,
              "collected": 4700293.0,
              "outstanding": 605229.0,
              "percent": 88.59
            },
            {
              "name": "V4",
              "expected": 4993664.0,
              "collected": 4397326.0,
              "outstanding": 596338.0,
              "percent": 88.06
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 7501156.0,
              "collected": 6881642.0,
              "outstanding": 619514.0,
              "percent": 91.74
            },
            {
              "name": "V2",
              "expected": 6269720.0,
              "collected": 5723516.0,
              "outstanding": 546204.0,
              "percent": 91.29
            },
            {
              "name": "V3",
              "expected": 5550329.0,
              "collected": 5019197.0,
              "outstanding": 531132.0,
              "percent": 90.43
            },
            {
              "name": "V4",
              "expected": 5205699.0,
              "collected": 4723393.0,
              "outstanding": 482306.0,
              "percent": 90.74
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 156303060.79000002,
      "financial_aid": 51550835.79,
      "gross_after_fa": 104752225.00000003,
      "net_revenue": 74764754.696767,
      "collections": 74764754.696767,
      "outstanding": 7442078.857302118,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2022-2023": {
    "year": "2022-2023",
    "semesters": {
      "Summer_2022_2023": {
        "semester": "Summer_2022_2023",
        "students": 12771.0,
        "students_excluding_drop": 10760.0,
        "total_paid_lusd": 5205333.0,
        "total_unpaid_lusd": 182226.0,
        "total_paid_percent_lusd": 96.62,
        "total_paid_cusd": 3346525.0,
        "total_unpaid_cusd": 162299.0,
        "total_paid_percent_cusd": 95.37,
        "fa_amounts": 4419065.67,
        "before_fa": 13315448.67,
        "total_expected_revenue_lusd": 5387559.0,
        "total_expected_revenue_cusd": 3508824.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 3007174.0,
              "collected": 2917523.0,
              "outstanding": 89651.0,
              "percent": 97.02
            },
            {
              "name": "V2",
              "expected": 2358955.0,
              "collected": 2266450.0,
              "outstanding": 92505.0,
              "percent": 96.08
            },
            {
              "name": "V3",
              "expected": 20488.0,
              "collected": 20418.0,
              "outstanding": 70.0,
              "percent": 99.66
            },
            {
              "name": "V4",
              "expected": 942.0,
              "collected": 942.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 1983440.0,
              "collected": 1898578.0,
              "outstanding": 84862.0,
              "percent": 95.72
            },
            {
              "name": "V2",
              "expected": 1502933.0,
              "collected": 1427388.0,
              "outstanding": 75545.0,
              "percent": 94.97
            },
            {
              "name": "V3",
              "expected": 19019.0,
              "collected": 17974.0,
              "outstanding": 1045.0,
              "percent": 94.51
            },
            {
              "name": "V4",
              "expected": 3432.0,
              "collected": 2585.0,
              "outstanding": 847.0,
              "percent": 75.32
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2022_2023": {
        "semester": "Spring_2022_2023",
        "students": 27317.0,
        "students_excluding_drop": 26679.0,
        "total_paid_lusd": 28940422.0,
        "total_unpaid_lusd": 1927610.0,
        "total_paid_percent_lusd": 93.76,
        "total_paid_cusd": 13600874.0,
        "total_unpaid_cusd": 996538.0,
        "total_paid_percent_cusd": 93.17,
        "fa_amounts": 25209129.63,
        "before_fa": 70674573.63,
        "total_expected_revenue_lusd": 30868032.0,
        "total_expected_revenue_cusd": 14597412.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 10566545.0,
              "collected": 10042240.0,
              "outstanding": 524305.0,
              "percent": 95.04
            },
            {
              "name": "V2",
              "expected": 7409894.0,
              "collected": 6957528.0,
              "outstanding": 452366.0,
              "percent": 93.9
            },
            {
              "name": "V3",
              "expected": 6524755.0,
              "collected": 6070766.0,
              "outstanding": 453989.0,
              "percent": 93.04
            },
            {
              "name": "V4",
              "expected": 6255430.0,
              "collected": 5760643.0,
              "outstanding": 494787.0,
              "percent": 92.09
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 4861078.0,
              "collected": 4569264.0,
              "outstanding": 291814.0,
              "percent": 94.0
            },
            {
              "name": "V2",
              "expected": 3655638.0,
              "collected": 3426273.0,
              "outstanding": 229365.0,
              "percent": 93.73
            },
            {
              "name": "V3",
              "expected": 3043762.0,
              "collected": 2820550.0,
              "outstanding": 223212.0,
              "percent": 92.67
            },
            {
              "name": "V4",
              "expected": 2909813.0,
              "collected": 2682863.0,
              "outstanding": 226950.0,
              "percent": 92.2
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2022_2023": {
        "semester": "Fall_2022_2023",
        "students": 32128.0,
        "students_excluding_drop": 29935.0,
        "total_paid_lusd": 31169285.0,
        "total_unpaid_lusd": 3179771.0,
        "total_paid_percent_lusd": 90.74,
        "total_paid_cusd": 14839861.0,
        "total_unpaid_cusd": 1527112.0,
        "total_paid_percent_cusd": 90.67,
        "fa_amounts": 27782270.26,
        "before_fa": 78498299.26,
        "total_expected_revenue_lusd": 34349056.0,
        "total_expected_revenue_cusd": 16366973.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 12234035.0,
              "collected": 11426685.0,
              "outstanding": 807350.0,
              "percent": 93.4
            },
            {
              "name": "V2",
              "expected": 8314556.0,
              "collected": 7575239.0,
              "outstanding": 739317.0,
              "percent": 91.11
            },
            {
              "name": "V3",
              "expected": 7101388.0,
              "collected": 6286478.0,
              "outstanding": 814910.0,
              "percent": 88.52
            },
            {
              "name": "V4",
              "expected": 6649398.0,
              "collected": 5831715.0,
              "outstanding": 817683.0,
              "percent": 87.7
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 5356435.0,
              "collected": 4907402.0,
              "outstanding": 449033.0,
              "percent": 91.62
            },
            {
              "name": "V2",
              "expected": 3996800.0,
              "collected": 3684951.0,
              "outstanding": 311849.0,
              "percent": 92.2
            },
            {
              "name": "V3",
              "expected": 3236999.0,
              "collected": 2915766.0,
              "outstanding": 321233.0,
              "percent": 90.08
            },
            {
              "name": "V4",
              "expected": 3047605.0,
              "collected": 2724430.0,
              "outstanding": 323175.0,
              "percent": 89.4
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 162488321.56,
      "financial_aid": 57410465.56,
      "gross_after_fa": 105077856.0,
      "net_revenue": 68194751.63879599,
      "collections": 68194751.63879599,
      "outstanding": 5634447.885172798,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2021-2022": {
    "year": "2021-2022",
    "semesters": {
      "Summer_2021_2022": {
        "semester": "Summer_2021_2022",
        "students": 17475.0,
        "students_excluding_drop": 16047.0,
        "total_paid_lusd": 11682428.0,
        "total_unpaid_lusd": 424345.0,
        "total_paid_percent_lusd": 96.49,
        "total_paid_cusd": 2013.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 7189583.1999999,
        "before_fa": 19298369.2,
        "total_expected_revenue_lusd": 12106773.0,
        "total_expected_revenue_cusd": 2013.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 5566226.0,
              "collected": 5415293.0,
              "outstanding": 150933.0,
              "percent": 97.29
            },
            {
              "name": "V2",
              "expected": 6135269.0,
              "collected": 5863482.0,
              "outstanding": 271787.0,
              "percent": 95.57
            },
            {
              "name": "V3",
              "expected": 343497.0,
              "collected": 341872.0,
              "outstanding": 1625.0,
              "percent": 99.53
            },
            {
              "name": "V4",
              "expected": 36391.0,
              "collected": 36391.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2013.0,
              "collected": 2013.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2021_2022": {
        "semester": "Spring_2021_2022",
        "students": 30123.0,
        "students_excluding_drop": 29583.0,
        "total_paid_lusd": 45801550.0,
        "total_unpaid_lusd": 3211736.0,
        "total_paid_percent_lusd": 93.45,
        "total_paid_cusd": 3756.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 31723777.6,
        "before_fa": 80740819.6,
        "total_expected_revenue_lusd": 49013286.0,
        "total_expected_revenue_cusd": 3756.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 18184567.0,
              "collected": 17314673.0,
              "outstanding": 869894.0,
              "percent": 95.22
            },
            {
              "name": "V2",
              "expected": 12453030.0,
              "collected": 11699368.0,
              "outstanding": 753662.0,
              "percent": 93.95
            },
            {
              "name": "V3",
              "expected": 9487243.0,
              "collected": 8691177.0,
              "outstanding": 796066.0,
              "percent": 91.61
            },
            {
              "name": "V4",
              "expected": 8591227.0,
              "collected": 7801558.0,
              "outstanding": 789669.0,
              "percent": 90.81
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 3756.0,
              "collected": 3756.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2021_2022": {
        "semester": "Fall_2021_2022",
        "students": 34114.0,
        "students_excluding_drop": 33201.0,
        "total_paid_lusd": 49279671.0,
        "total_unpaid_lusd": 5433156.0,
        "total_paid_percent_lusd": 90.07,
        "total_paid_cusd": 68482.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 36098548.91,
        "before_fa": 90879857.91,
        "total_expected_revenue_lusd": 54712827.0,
        "total_expected_revenue_cusd": 68482.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 19653715.0,
              "collected": 18181871.0,
              "outstanding": 1471844.0,
              "percent": 92.51
            },
            {
              "name": "V2",
              "expected": 14460489.0,
              "collected": 13155657.0,
              "outstanding": 1304832.0,
              "percent": 90.98
            },
            {
              "name": "V3",
              "expected": 10817487.0,
              "collected": 9437331.0,
              "outstanding": 1380156.0,
              "percent": 87.24
            },
            {
              "name": "V4",
              "expected": 9462085.0,
              "collected": 8201010.0,
              "outstanding": 1261075.0,
              "percent": 86.67
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 66746.0,
              "collected": 66746.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1736.0,
              "collected": 1736.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 190919046.70999998,
      "financial_aid": 75011909.70999989,
      "gross_after_fa": 115907137.00000009,
      "net_revenue": 59585761.03344482,
      "collections": 59585761.03344482,
      "outstanding": 5055316.053511705,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2020-2021": {
    "year": "2020-2021",
    "semesters": {
      "Summer_2020_2021": {
        "semester": "Summer_2020_2021",
        "students": 18749.0,
        "students_excluding_drop": 17869.0,
        "total_paid_lusd": 11670308.0,
        "total_unpaid_lusd": 551305.0,
        "total_paid_percent_lusd": 95.49,
        "total_paid_cusd": 8155.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 9559301.2199999,
        "before_fa": 21789069.22,
        "total_expected_revenue_lusd": 12221613.0,
        "total_expected_revenue_cusd": 8155.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 6845482.0,
              "collected": 6629512.0,
              "outstanding": 215970.0,
              "percent": 96.85
            },
            {
              "name": "V2",
              "expected": 5244957.0,
              "collected": 4910485.0,
              "outstanding": 334472.0,
              "percent": 93.62
            },
            {
              "name": "V3",
              "expected": 127614.0,
              "collected": 126751.0,
              "outstanding": 863.0,
              "percent": 99.32
            },
            {
              "name": "V4",
              "expected": 3293.0,
              "collected": 3293.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 6196.0,
              "collected": 6196.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1959.0,
              "collected": 1959.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2020_2021": {
        "semester": "Spring_2020_2021",
        "students": 28585.0,
        "students_excluding_drop": 28282.0,
        "total_paid_lusd": 41019533.0,
        "total_unpaid_lusd": 2779980.0,
        "total_paid_percent_lusd": 93.65,
        "total_paid_cusd": 33972.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 36746854.84,
        "before_fa": 80580339.84,
        "total_expected_revenue_lusd": 43799513.0,
        "total_expected_revenue_cusd": 33972.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 19359876.0,
              "collected": 18539678.0,
              "outstanding": 820198.0,
              "percent": 95.76
            },
            {
              "name": "V2",
              "expected": 10691028.0,
              "collected": 10038040.0,
              "outstanding": 652988.0,
              "percent": 93.89
            },
            {
              "name": "V3",
              "expected": 7227166.0,
              "collected": 6558641.0,
              "outstanding": 668525.0,
              "percent": 90.75
            },
            {
              "name": "V4",
              "expected": 6371148.0,
              "collected": 5735648.0,
              "outstanding": 635500.0,
              "percent": 90.03
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 30232.0,
              "collected": 30232.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1245.0,
              "collected": 1245.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 1245.0,
              "collected": 1245.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 1250.0,
              "collected": 1250.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2020_2021": {
        "semester": "Fall_2020_2021",
        "students": 30768.0,
        "students_excluding_drop": 30024.0,
        "total_paid_lusd": 42644584.0,
        "total_unpaid_lusd": 4000234.0,
        "total_paid_percent_lusd": 91.42,
        "total_paid_cusd": 81285.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 39129488.31,
        "before_fa": 85855591.31,
        "total_expected_revenue_lusd": 46644818.0,
        "total_expected_revenue_cusd": 81285.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 18699597.0,
              "collected": 17566074.0,
              "outstanding": 1133523.0,
              "percent": 93.94
            },
            {
              "name": "V2",
              "expected": 12651853.0,
              "collected": 11704944.0,
              "outstanding": 946909.0,
              "percent": 92.52
            },
            {
              "name": "V3",
              "expected": 8202814.0,
              "collected": 7225617.0,
              "outstanding": 977197.0,
              "percent": 88.09
            },
            {
              "name": "V4",
              "expected": 6732195.0,
              "collected": 5802636.0,
              "outstanding": 929559.0,
              "percent": 86.19
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 78374.0,
              "collected": 78374.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1620.0,
              "collected": 1620.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 690.0,
              "collected": 690.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 601.0,
              "collected": 601.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 188225000.37,
      "financial_aid": 85435644.36999992,
      "gross_after_fa": 102789356.00000009,
      "net_revenue": 53264117.12820513,
      "collections": 53264117.12820513,
      "outstanding": 4086688.4057971016,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2019-2020": {
    "year": "2019-2020",
    "semesters": {
      "Summer_2019_2020": {
        "semester": "Summer_2019_2020",
        "students": 13675.0,
        "students_excluding_drop": 12905.0,
        "total_paid_lusd": 7480986.0,
        "total_unpaid_lusd": 255699.0,
        "total_paid_percent_lusd": 96.69,
        "total_paid_cusd": 24685.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 7104097.4,
        "before_fa": 14865467.4,
        "total_expected_revenue_lusd": 7736685.0,
        "total_expected_revenue_cusd": 24685.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 4924229.0,
              "collected": 4815441.0,
              "outstanding": 108788.0,
              "percent": 97.79
            },
            {
              "name": "V2",
              "expected": 2752736.0,
              "collected": 2607709.0,
              "outstanding": 145027.0,
              "percent": 94.73
            },
            {
              "name": "V3",
              "expected": 53632.0,
              "collected": 52391.0,
              "outstanding": 1241.0,
              "percent": 97.69
            },
            {
              "name": "V4",
              "expected": 4259.0,
              "collected": 3616.0,
              "outstanding": 643.0,
              "percent": 84.9
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 23590.0,
              "collected": 23590.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1095.0,
              "collected": 1095.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2019_2020": {
        "semester": "Spring_2019_2020",
        "students": 26278.0,
        "students_excluding_drop": 25791.0,
        "total_paid_lusd": 31760098.0,
        "total_unpaid_lusd": 2861980.0,
        "total_paid_percent_lusd": 91.73,
        "total_paid_cusd": 208914.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 32622602.47,
        "before_fa": 67453594.47,
        "total_expected_revenue_lusd": 34622078.0,
        "total_expected_revenue_cusd": 208914.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 16356063.0,
              "collected": 15369497.0,
              "outstanding": 986566.0,
              "percent": 93.97
            },
            {
              "name": "V2",
              "expected": 9280808.0,
              "collected": 8646475.0,
              "outstanding": 634333.0,
              "percent": 93.17
            },
            {
              "name": "V3",
              "expected": 4968014.0,
              "collected": 4330719.0,
              "outstanding": 637295.0,
              "percent": 87.17
            },
            {
              "name": "V4",
              "expected": 3946046.0,
              "collected": 3342260.0,
              "outstanding": 603786.0,
              "percent": 84.7
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 195934.0,
              "collected": 195934.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 10661.0,
              "collected": 10661.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 2039.0,
              "collected": 2039.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 280.0,
              "collected": 280.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2019_2020": {
        "semester": "Fall_2019_2020",
        "students": 29530.0,
        "students_excluding_drop": 28585.0,
        "total_paid_lusd": 26467902.0,
        "total_unpaid_lusd": 4204230.0,
        "total_paid_percent_lusd": 86.29,
        "total_paid_cusd": 7906296.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 33918940.08,
        "before_fa": 72497368.08,
        "total_expected_revenue_lusd": 30672132.0,
        "total_expected_revenue_cusd": 7906296.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 14296963.0,
              "collected": 12962837.0,
              "outstanding": 1334126.0,
              "percent": 90.67
            },
            {
              "name": "V2",
              "expected": 8764904.0,
              "collected": 7777543.0,
              "outstanding": 987361.0,
              "percent": 88.74
            },
            {
              "name": "V3",
              "expected": 4923420.0,
              "collected": 3934496.0,
              "outstanding": 988924.0,
              "percent": 79.91
            },
            {
              "name": "V4",
              "expected": 2584571.0,
              "collected": 1691126.0,
              "outstanding": 893445.0,
              "percent": 65.43
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 5786498.0,
              "collected": 5786498.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1365253.0,
              "collected": 1365253.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 553709.0,
              "collected": 553709.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 194113.0,
              "collected": 194113.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 154816429.95,
      "financial_aid": 73645639.94999999,
      "gross_after_fa": 81170790.0,
      "net_revenue": 44766977.49721293,
      "collections": 44766977.49721293,
      "outstanding": 4081331.6610925305,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2018-2019": {
    "year": "2018-2019",
    "semesters": {
      "Summer_2018_2019": {
        "semester": "Summer_2018_2019",
        "students": 13626.0,
        "students_excluding_drop": 11998.0,
        "total_paid_lusd": 2641773.0,
        "total_unpaid_lusd": 359862.0,
        "total_paid_percent_lusd": 88.01,
        "total_paid_cusd": 3952841.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 5825324.09,
        "before_fa": 12779800.09,
        "total_expected_revenue_lusd": 3001635.0,
        "total_expected_revenue_cusd": 3952841.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 2308393.0,
              "collected": 2130777.0,
              "outstanding": 177616.0,
              "percent": 92.31
            },
            {
              "name": "V2",
              "expected": 677419.0,
              "collected": 495173.0,
              "outstanding": 182246.0,
              "percent": 73.1
            },
            {
              "name": "V3",
              "expected": 14732.0,
              "collected": 14732.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 1091.0,
              "collected": 1091.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2007806.0,
              "collected": 2007806.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 1918664.0,
              "collected": 1918664.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 25200.0,
              "collected": 25200.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 1171.0,
              "collected": 1171.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2018_2019": {
        "semester": "Spring_2018_2019",
        "students": 25314.0,
        "students_excluding_drop": 24874.0,
        "total_paid_lusd": 9543183.0,
        "total_unpaid_lusd": 2784766.0,
        "total_paid_percent_lusd": 77.41,
        "total_paid_cusd": 20832199.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 28474637.67,
        "before_fa": 61634785.67,
        "total_expected_revenue_lusd": 12327949.0,
        "total_expected_revenue_cusd": 20832199.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 7419551.0,
              "collected": 6332217.0,
              "outstanding": 1087334.0,
              "percent": 85.35
            },
            {
              "name": "V2",
              "expected": 3052204.0,
              "collected": 2428258.0,
              "outstanding": 623946.0,
              "percent": 79.56
            },
            {
              "name": "V3",
              "expected": 1113671.0,
              "collected": 534270.0,
              "outstanding": 579401.0,
              "percent": 47.97
            },
            {
              "name": "V4",
              "expected": 733126.0,
              "collected": 239041.0,
              "outstanding": 494085.0,
              "percent": 32.61
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 8616160.0,
              "collected": 8616160.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 4590418.0,
              "collected": 4590418.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 3987547.0,
              "collected": 3987547.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 3512739.0,
              "collected": 3512739.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2018_2019": {
        "semester": "Fall_2018_2019",
        "students": 27798.0,
        "students_excluding_drop": 26790.0,
        "total_paid_lusd": 7003399.0,
        "total_unpaid_lusd": 3768461.0,
        "total_paid_percent_lusd": 65.02,
        "total_paid_cusd": 25524795.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 29595506.8,
        "before_fa": 65892161.8,
        "total_expected_revenue_lusd": 10771860.0,
        "total_expected_revenue_cusd": 25524795.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 6424410.0,
              "collected": 5028346.0,
              "outstanding": 1396064.0,
              "percent": 78.27
            },
            {
              "name": "V2",
              "expected": 2388841.0,
              "collected": 1514884.0,
              "outstanding": 873957.0,
              "percent": 63.42
            },
            {
              "name": "V3",
              "expected": 1126450.0,
              "collected": 317292.0,
              "outstanding": 809158.0,
              "percent": 28.17
            },
            {
              "name": "V4",
              "expected": 820675.0,
              "collected": 137285.0,
              "outstanding": 683390.0,
              "percent": 16.73
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 10464736.0,
              "collected": 10464736.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 5769258.0,
              "collected": 5769258.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 4799432.0,
              "collected": 4799432.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4254688.0,
              "collected": 4254688.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 140306747.56,
      "financial_aid": 63895468.56,
      "gross_after_fa": 76411279.0,
      "net_revenue": 61005685.05574136,
      "collections": 61005685.05574136,
      "outstanding": 3853449.8327759197,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2017-2018": {
    "year": "2017-2018",
    "semesters": {
      "Summer_2017_2018": {
        "semester": "Summer_2017_2018",
        "students": 13666.0,
        "students_excluding_drop": 11832.0,
        "total_paid_lusd": 1363470.0,
        "total_unpaid_lusd": 485542.0,
        "total_paid_percent_lusd": 73.74,
        "total_paid_cusd": 5091008.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 5263037.68,
        "before_fa": 12203057.68,
        "total_expected_revenue_lusd": 1849012.0,
        "total_expected_revenue_cusd": 5091008.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 1432735.0,
              "collected": 1181386.0,
              "outstanding": 251349.0,
              "percent": 82.46
            },
            {
              "name": "V2",
              "expected": 410620.0,
              "collected": 176427.0,
              "outstanding": 234193.0,
              "percent": 42.97
            },
            {
              "name": "V3",
              "expected": 5657.0,
              "collected": 5657.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2572242.0,
              "collected": 2572242.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 2467461.0,
              "collected": 2467461.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 46855.0,
              "collected": 46855.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 3485.0,
              "collected": 3485.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2017_2018": {
        "semester": "Spring_2017_2018",
        "students": 23339.0,
        "students_excluding_drop": 22866.0,
        "total_paid_lusd": 4461844.0,
        "total_unpaid_lusd": 2629127.0,
        "total_paid_percent_lusd": 62.92,
        "total_paid_cusd": 23612858.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 24622020.84,
        "before_fa": 55325849.84,
        "total_expected_revenue_lusd": 7090971.0,
        "total_expected_revenue_cusd": 23612858.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 4449134.0,
              "collected": 3392962.0,
              "outstanding": 1056172.0,
              "percent": 76.26
            },
            {
              "name": "V2",
              "expected": 1451024.0,
              "collected": 855276.0,
              "outstanding": 595748.0,
              "percent": 58.94
            },
            {
              "name": "V3",
              "expected": 685076.0,
              "collected": 141394.0,
              "outstanding": 543682.0,
              "percent": 20.64
            },
            {
              "name": "V4",
              "expected": 504301.0,
              "collected": 70776.0,
              "outstanding": 433525.0,
              "percent": 14.03
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9496408.0,
              "collected": 9496408.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 5288924.0,
              "collected": 5288924.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 4593032.0,
              "collected": 4593032.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4049132.0,
              "collected": 4049132.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2017_2018": {
        "semester": "Fall_2017_2018",
        "students": 25669.0,
        "students_excluding_drop": 24590.0,
        "total_paid_lusd": 3369151.0,
        "total_unpaid_lusd": 3502941.0,
        "total_paid_percent_lusd": 49.03,
        "total_paid_cusd": 26770036.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 25451557.7,
        "before_fa": 59093685.7,
        "total_expected_revenue_lusd": 6872092.0,
        "total_expected_revenue_cusd": 26770036.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 3970976.0,
              "collected": 2652063.0,
              "outstanding": 1318913.0,
              "percent": 66.79
            },
            {
              "name": "V2",
              "expected": 1386032.0,
              "collected": 561729.0,
              "outstanding": 824303.0,
              "percent": 40.53
            },
            {
              "name": "V3",
              "expected": 844418.0,
              "collected": 103277.0,
              "outstanding": 741141.0,
              "percent": 12.23
            },
            {
              "name": "V4",
              "expected": 670666.0,
              "collected": 52082.0,
              "outstanding": 618584.0,
              "percent": 7.77
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 10572594.0,
              "collected": 10572594.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 6022305.0,
              "collected": 6022305.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 5209015.0,
              "collected": 5209015.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4676430.0,
              "collected": 4676430.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 126622593.22000001,
      "financial_aid": 55336616.22,
      "gross_after_fa": 71285977.00000001,
      "net_revenue": 60599021.843924195,
      "collections": 60599021.843924195,
      "outstanding": 3688745.8193979934,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2016-2017": {
    "year": "2016-2017",
    "semesters": {
      "Summer_2016_2017": {
        "semester": "Summer_2016_2017",
        "students": 11721.0,
        "students_excluding_drop": 10361.0,
        "total_paid_lusd": 763101.0,
        "total_unpaid_lusd": 462056.0,
        "total_paid_percent_lusd": 62.29,
        "total_paid_cusd": 5014991.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 4476996.55,
        "before_fa": 10717144.55,
        "total_expected_revenue_lusd": 1225157.0,
        "total_expected_revenue_cusd": 5014991.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 948487.0,
              "collected": 691276.0,
              "outstanding": 257211.0,
              "percent": 72.88
            },
            {
              "name": "V2",
              "expected": 275141.0,
              "collected": 70296.0,
              "outstanding": 204845.0,
              "percent": 25.55
            },
            {
              "name": "V3",
              "expected": 1529.0,
              "collected": 1529.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2416198.0,
              "collected": 2416198.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 2516414.0,
              "collected": 2516414.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 74929.0,
              "collected": 74929.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 6055.0,
              "collected": 6055.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2016_2017": {
        "semester": "Spring_2016_2017",
        "students": 20739.0,
        "students_excluding_drop": 20415.0,
        "total_paid_lusd": 2425767.0,
        "total_unpaid_lusd": 2378976.0,
        "total_paid_percent_lusd": 50.49,
        "total_paid_cusd": 22913334.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 20329792.97,
        "before_fa": 48047869.97,
        "total_expected_revenue_lusd": 4804743.0,
        "total_expected_revenue_cusd": 22913334.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 2956653.0,
              "collected": 1979902.0,
              "outstanding": 976751.0,
              "percent": 66.96
            },
            {
              "name": "V2",
              "expected": 876294.0,
              "collected": 339715.0,
              "outstanding": 536579.0,
              "percent": 38.77
            },
            {
              "name": "V3",
              "expected": 543806.0,
              "collected": 59610.0,
              "outstanding": 484196.0,
              "percent": 10.96
            },
            {
              "name": "V4",
              "expected": 426490.0,
              "collected": 45040.0,
              "outstanding": 381450.0,
              "percent": 10.56
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9090245.0,
              "collected": 9090245.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 5012419.0,
              "collected": 5012419.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 4502125.0,
              "collected": 4502125.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4105640.0,
              "collected": 4105640.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Fall_2016_2017": {
        "semester": "Fall_2016_2017",
        "students": 22685.0,
        "students_excluding_drop": 21810.0,
        "total_paid_lusd": 1894327.0,
        "total_unpaid_lusd": 2967786.0,
        "total_paid_percent_lusd": 38.96,
        "total_paid_cusd": 25200664.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 20796215.45,
        "before_fa": 50858992.45,
        "total_expected_revenue_lusd": 4862113.0,
        "total_expected_revenue_cusd": 25200664.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 2709071.0,
              "collected": 1569784.0,
              "outstanding": 1139287.0,
              "percent": 57.95
            },
            {
              "name": "V2",
              "expected": 951425.0,
              "collected": 254391.0,
              "outstanding": 697034.0,
              "percent": 26.74
            },
            {
              "name": "V3",
              "expected": 657730.0,
              "collected": 42301.0,
              "outstanding": 615429.0,
              "percent": 6.43
            },
            {
              "name": "V4",
              "expected": 539277.0,
              "collected": 26351.0,
              "outstanding": 512926.0,
              "percent": 4.89
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 9807206.0,
              "collected": 9807206.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 5653527.0,
              "collected": 5653527.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 4961164.0,
              "collected": 4961164.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4535048.0,
              "collected": 4535048.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 109624006.97,
      "financial_aid": 45603004.97,
      "gross_after_fa": 64021002.0,
      "net_revenue": 55962431.0289855,
      "collections": 55962431.0289855,
      "outstanding": 3237914.1583054624,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  },
  "2015-2016": {
    "year": "2015-2016",
    "semesters": {
      "Summer_2015_2016": {
        "semester": "Summer_2015_2016",
        "students": 10502.0,
        "students_excluding_drop": 9190.0,
        "total_paid_lusd": 399000.0,
        "total_unpaid_lusd": 353362.0,
        "total_paid_percent_lusd": 53.03,
        "total_paid_cusd": 4856470.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 3611030.45,
        "before_fa": 9219862.45,
        "total_expected_revenue_lusd": 752362.0,
        "total_expected_revenue_cusd": 4856470.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 552693.0,
              "collected": 360160.0,
              "outstanding": 192533.0,
              "percent": 65.16
            },
            {
              "name": "V2",
              "expected": 199194.0,
              "collected": 38365.0,
              "outstanding": 160829.0,
              "percent": 19.26
            },
            {
              "name": "V3",
              "expected": 475.0,
              "collected": 475.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 2325379.0,
              "collected": 2325379.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 2477490.0,
              "collected": 2477490.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 47188.0,
              "collected": 47188.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 5490.0,
              "collected": 5490.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      },
      "Spring_2015_2016": {
        "semester": "Spring_2015_2016",
        "students": 18861.0,
        "students_excluding_drop": 18544.0,
        "total_paid_lusd": 1323761.0,
        "total_unpaid_lusd": 2058875.0,
        "total_paid_percent_lusd": 39.13,
        "total_paid_cusd": 22285832.0,
        "total_unpaid_cusd": 0.0,
        "total_paid_percent_cusd": 100.0,
        "fa_amounts": 16563582.94,
        "before_fa": 42232050.94,
        "total_expected_revenue_lusd": 3382636.0,
        "total_expected_revenue_cusd": 22285832.0,
        "vouchers": {
          "lusd": [
            {
              "name": "V1",
              "expected": 1962251.0,
              "collected": 1094597.0,
              "outstanding": 867654.0,
              "percent": 55.78
            },
            {
              "name": "V2",
              "expected": 628474.0,
              "collected": 166340.0,
              "outstanding": 462134.0,
              "percent": 26.47
            },
            {
              "name": "V3",
              "expected": 451741.0,
              "collected": 41949.0,
              "outstanding": 409792.0,
              "percent": 9.29
            },
            {
              "name": "V4",
              "expected": 340002.0,
              "collected": 20707.0,
              "outstanding": 319295.0,
              "percent": 6.09
            }
          ],
          "cusd": [
            {
              "name": "V1",
              "expected": 8534277.0,
              "collected": 8534277.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V2",
              "expected": 4916747.0,
              "collected": 4916747.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V3",
              "expected": 4526122.0,
              "collected": 4526122.0,
              "outstanding": 0.0,
              "percent": 100.0
            },
            {
              "name": "V4",
              "expected": 4133381.0,
              "collected": 4133381.0,
              "outstanding": 0.0,
              "percent": 100.0
            }
          ]
        },
        "previous_balance_lusd": 0.0,
        "previous_balance_cusd": 0.0,
        "reserves_lusd": 0,
        "reserves_cusd": 0
      }
    },
    "totals": {
      "gross_before_fa": 51451913.39,
      "financial_aid": 20174613.39,
      "gross_after_fa": 31277300.0,
      "net_revenue": 28102592.41248606,
      "collections": 28102592.41248606,
      "outstanding": 1344613.712374582,
      "expenses": 0.0
    },
    "reserves": {
      "monthly": [],
      "by_semester": {
        "Fall": 0,
        "Spring": 0,
        "Summer": 0
      },
      "total": 0.0
    }
  }
};

        // Global variables
        let currentYear = null;
        let currentView = 'dashboard';
        let charts = {};
        let trendsInitialized = false;

        // Initialize Chart.js with data labels plugin
        Chart.register(ChartDataLabels);

        // Switch between Dashboard and Graphs views
        function switchView(view) {
            currentView = view;

            // Update button styles
            const dashboardBtn = document.getElementById('dashboardViewBtn');
            const graphsBtn = document.getElementById('graphsViewBtn');

            if (view === 'dashboard') {
                // Show dashboard
                document.getElementById('dashboardView').style.display = 'block';
                document.getElementById('graphsView').style.display = 'none';

                // Update button styles
                dashboardBtn.style.background = 'white';
                dashboardBtn.style.color = '#2c3e50';
                dashboardBtn.style.borderColor = 'white';

                graphsBtn.style.background = 'transparent';
                graphsBtn.style.color = 'white';
                graphsBtn.style.borderColor = 'white';
            } else {
                // Show graphs
                document.getElementById('dashboardView').style.display = 'none';
                document.getElementById('graphsView').style.display = 'block';

                // Update button styles
                graphsBtn.style.background = 'white';
                graphsBtn.style.color = '#2c3e50';
                graphsBtn.style.borderColor = 'white';

                dashboardBtn.style.background = 'transparent';
                dashboardBtn.style.color = 'white';
                dashboardBtn.style.borderColor = 'white';

                // Initialize trends if not already done
                if (!trendsInitialized) {
                    updateTrendGraphs();
                    trendsInitialized = true;
                }
            }
        }

        // Utility functions
        function formatCurrency(value) {
            if (value === null || value === undefined || isNaN(value)) return '$0';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function formatLUSD(value) {
            if (value === null || value === undefined || isNaN(value)) return '0';
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        // Only convert for 2024-2025 and 2025-2026
        function shouldConvertLUSD(year) {
            return year === '2024-2025' || year === '2025-2026';
        }

        function getExchangeRate(year) {
            if (year === '2024-2025') return 35000;
            if (year === '2025-2026') return 50000;
            return null; // No conversion for other years
        }

        function convertLUSDtoUSD(lusdValue, year) {
            if (!lusdValue || isNaN(lusdValue)) return 0;
            if (!shouldConvertLUSD(year)) return lusdValue; // Return true value
            const rate = getExchangeRate(year);
            return (lusdValue * rate) / 89700;
        }

        function formatPercent(value) {
            if (value === null || value === undefined || isNaN(value)) return '0.0%';
            return value.toFixed(1) + '%';
        }

        // Calculate actual net revenue (USD equivalent) for a given year
        function calculateActualNetRevenue(data) {
            if (shouldConvertLUSD(data.year)) {
                // For 2024-2025 and 2025-2026, calculate CUSD + converted LUSD
                let cusdTotal = 0;
                let lusdTotal = 0;
                Object.values(data.semesters).forEach(sem => {
                    cusdTotal += sem.total_expected_revenue_cusd || 0;
                    lusdTotal += sem.total_expected_revenue_lusd || 0;
                });
                const convertedLUSD = convertLUSDtoUSD(lusdTotal, data.year);
                return cusdTotal + convertedLUSD;
            } else {
                // For other years, use the data's net_revenue
                return data.totals.net_revenue;
            }
        }

        function getPerformanceClass(rate) {
            if (rate >= 75) return 'good';
            if (rate >= 50) return 'warning';
            return 'poor';
        }

        function getPerformanceIcon(rate) {
            if (rate >= 75) return 'âœ“';
            if (rate >= 50) return '!';
            return 'âœ—';
        }

        // Initialize year selector
        function initializeYearSelector() {
            const container = document.getElementById('yearButtons');
            container.innerHTML = '';

            Object.keys(HARDCODED_DATA).forEach(year => {
                const button = document.createElement('button');
                button.className = 'year-btn';
                button.textContent = year;
                button.onclick = () => selectYear(year);
                container.appendChild(button);
            });
        }

        // Select and display a year
        function selectYear(year) {
            // Update button states
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === year) {
                    btn.classList.add('active');
                }
            });

            currentYear = year;
            displayYearData(HARDCODED_DATA[year]);

            // Show main content
            document.getElementById('mainContent').style.display = 'block';
        }

        // Display data for selected year
        function displayYearData(data) {
            if (!data) return;

            // Update alert banner
            updateAlertBanner(data);

            // Show currency note only for 2024-2025 and 2025-2026
            const showConversionNote = shouldConvertLUSD(data.year) &&
                                       Object.values(data.semesters).some(s => s.total_expected_revenue_lusd > 0);

            if (showConversionNote) {
                document.getElementById('currencyNote').style.display = 'block';
                const rate = getExchangeRate(data.year);
                const rateText = `LUSD Ã— ${rate.toLocaleString()} Ã· 89,700 = USD`;
                document.getElementById('conversionRate').textContent = rateText;
            } else {
                document.getElementById('currencyNote').style.display = 'none';
            }

            // Update KPIs
            updateKPIs(data);

            // Update semester sections
            updateSemesterSections(data);

            // Update reserves for 2024-2025 and 2025-2026
            if ((data.year === '2024-2025' || data.year === '2025-2026') && data.reserves && data.reserves.total > 0) {
                updateReserves(data.reserves);
                document.getElementById('reservesSection').style.display = 'block';
            } else {
                document.getElementById('reservesSection').style.display = 'none';
            }

            // Create/update charts
            updateCharts(data);

            // Update summary table
            updateSummaryTable(data);
        }

        // Update alert banner
        function updateAlertBanner(data) {
            // Only show financial performance if we have expense data (2024-2025)
            if (data.totals.expenses && data.totals.expenses > 0) {
                const actualNetRevenue = calculateActualNetRevenue(data);
                const surplus = data.totals.collections - data.totals.expenses;
                const expectedSurplus = actualNetRevenue - data.totals.expenses;

                let title, text, bannerClass;

                if (surplus > 0) {
                    title = 'âœ… Strong Financial Performance';
                    text = `Cash surplus of ${formatCurrency(surplus)} â€¢ Expected surplus of ${formatCurrency(expectedSurplus)} if all receivables collected`;
                    bannerClass = 'alert-banner';
                } else {
                    title = 'âš ï¸ Financial Alert';
                    text = `Operating deficit of ${formatCurrency(Math.abs(surplus))} â€¢ Action required to improve collections`;
                    bannerClass = 'alert-banner warning';
                }

                document.getElementById('alertTitle').textContent = title;
                document.getElementById('alertText').textContent = text;
                document.getElementById('alertBanner').className = bannerClass;
                document.getElementById('alertBanner').style.display = 'block';
            } else {
                // No expense data available for other years
                document.getElementById('alertBanner').style.display = 'none';
            }
        }

        // Update KPIs
        function updateKPIs(data) {
            const kpiSection = document.getElementById('kpiSection');

            const kpis = [];

            // Only add KPIs for data that exists
            if (data.totals.gross_before_fa !== 'N/A') {
                kpis.push({
                    title: 'Total Gross Amount (Before FA)',
                    value: data.totals.gross_before_fa,
                    change: 'Total amount before financial aid deductions',
                    class: 'revenue',
                    icon: 'ðŸ“ˆ'
                });
            }

            if (data.totals.financial_aid !== 'N/A') {
                const faPercent = data.totals.gross_before_fa !== 'N/A' ?
                    `${((data.totals.financial_aid / data.totals.gross_before_fa) * 100).toFixed(1)}% of gross amount` :
                    'Financial assistance provided';
                kpis.push({
                    title: 'Financial Aid',
                    value: data.totals.financial_aid,
                    change: faPercent,
                    class: 'fa',
                    icon: 'ðŸŽ“'
                });
            }

            // Gross Revenue (After FA) - always available
            if (data.totals.gross_after_fa !== undefined && data.totals.gross_after_fa !== 'N/A') {
                kpis.push({
                    title: 'Gross Revenue (After FA)',
                    value: data.totals.gross_after_fa,
                    change: 'Total revenue after financial aid deductions',
                    class: 'revenue',
                    icon: 'ðŸ’µ'
                });
            }

            // Net Revenue - this is the USD equivalent value after converting LUSD to USD
            // For years before 2024, LUSD had much lower value, so net revenue < gross_after_fa
            let revenueChangeText;
            const actualNetRevenue = calculateActualNetRevenue(data);

            // Calculate CUSD and LUSD totals from semesters for display
            let cusdTotal = 0;
            let lusdTotal = 0;
            Object.values(data.semesters).forEach(sem => {
                cusdTotal += sem.total_expected_revenue_cusd || 0;
                lusdTotal += sem.total_expected_revenue_lusd || 0;
            });

            if (shouldConvertLUSD(data.year)) {
                // For 2024-2025 and 2025-2026, show the breakdown
                const convertedLUSD = convertLUSDtoUSD(lusdTotal, data.year);

                if (lusdTotal > 0) {
                    revenueChangeText = `CUSD: ${formatCurrency(cusdTotal)} + LUSD: ${formatLUSD(lusdTotal)} (â†’ ${formatCurrency(convertedLUSD)} USD)`;
                } else {
                    revenueChangeText = `CUSD: ${formatCurrency(cusdTotal)}`;
                }
            } else {
                // For other years, show both the nominal and USD equivalent
                if (data.totals.gross_after_fa) {
                    revenueChangeText = `USD value of ${formatCurrency(data.totals.gross_after_fa)} (CUSD + LUSD nominal)`;
                } else {
                    revenueChangeText = `Total expected revenue in USD equivalent`;
                }
            }

            // Calculate percentage of net revenue from gross after FA
            let netRevenuePercent = '';
            if (data.totals.gross_after_fa && data.totals.gross_after_fa > 0) {
                const percentage = (actualNetRevenue / data.totals.gross_after_fa * 100).toFixed(1);
                netRevenuePercent = ` â€¢ ${percentage}% of Gross After FA`;
            }

            kpis.push({
                title: 'Net Revenue (USD Equivalent)',
                value: actualNetRevenue,
                change: revenueChangeText + netRevenuePercent,
                class: 'revenue',
                icon: 'ðŸ’°'
            });

            // Collections - always available
            kpis.push({
                title: 'Total Collections',
                value: data.totals.collections,
                change: `${((data.totals.collections / actualNetRevenue) * 100).toFixed(1)}% of net revenue`,
                class: 'collections',
                icon: 'ðŸ’µ'
            });

            // Outstanding - always available
            kpis.push({
                title: 'Total Outstanding',
                value: data.totals.outstanding,
                change: `${((data.totals.outstanding / actualNetRevenue) * 100).toFixed(1)}% of net revenue`,
                class: 'outstanding',
                icon: 'ðŸ“Š'
            });

            // Only show expenses if available (mainly for 2024-2025)
            if (data.totals.expenses && data.totals.expenses > 0) {
                kpis.push({
                    title: 'Operating Expenses',
                    value: data.totals.expenses,
                    change: `Total operating costs for ${data.year}`,
                    class: 'expenses',
                    icon: 'ðŸ’¸'
                });
            }

            // Show reserves for 2024-2025 and 2025-2026
            if ((data.year === '2024-2025' || data.year === '2025-2026') && data.reserves && data.reserves.total > 0) {
                kpis.push({
                    title: 'Total Cash Reserves',
                    value: data.reserves.total,
                    change: `Available cash reserves across all semesters`,
                    class: 'result',
                    icon: 'ðŸ’Ž',
                    borderColor: '#2ecc71'
                });
            }

            kpiSection.innerHTML = kpis.map(kpi => {
                const borderStyle = kpi.borderColor ? `style="border-color: ${kpi.borderColor};"` : '';
                const iconStyle = kpi.borderColor ? `style="background: ${kpi.borderColor};"` : '';

                return `
                    <div class="kpi-card ${kpi.class}" ${borderStyle}>
                        <div class="kpi-header">
                            <div class="kpi-title">${kpi.title}</div>
                            <div class="kpi-icon ${kpi.class}" ${iconStyle}>${kpi.icon}</div>
                        </div>
                        <div class="kpi-value">${formatCurrency(kpi.value)}</div>
                        <div class="kpi-change">${kpi.change}</div>
                    </div>
                `;
            }).join('');
        }

        // Update semester sections
        function updateSemesterSections(data) {
            const container = document.getElementById('semesterSections');
            const semesters = Object.keys(data.semesters);
            const shouldConvert = shouldConvertLUSD(data.year);

            container.innerHTML = semesters.map((sem, index) => {
                const semData = data.semesters[sem];
                const semesterName = sem.replace(/_/g, ' ');

                const borderColors = ['#3498db', '#9b59b6', '#e67e22'];
                const borderColor = borderColors[index % 3];

                return `
                    <div class="semester-section">
                        <div class="semester-header" style="border-left-color: ${borderColor}">
                            <h2>${semesterName} â€¢ ${(semData.students || 0).toLocaleString()} Students</h2>
                            <div class="performance-badge">
                                <div class="badge-item ${getPerformanceClass(semData.total_paid_percent_cusd || 0)}">
                                    ${getPerformanceIcon(semData.total_paid_percent_cusd || 0)} CUSD ${formatPercent(semData.total_paid_percent_cusd || 0)}
                                </div>
                                ${semData.total_expected_revenue_lusd > 0 ? `
                                <div class="badge-item ${getPerformanceClass(semData.total_paid_percent_lusd || 0)}">
                                    ${getPerformanceIcon(semData.total_paid_percent_lusd || 0)} LUSD ${formatPercent(semData.total_paid_percent_lusd || 0)}
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="semester-metrics">
                            <!-- USD/CUSD Row -->
                            <div class="currency-row">
                                <div class="metric-card cusd">
                                    <div class="metric-header">
                                        <div class="metric-title">Expected Revenue</div>
                                        <span class="currency-badge cusd">CUSD</span>
                                    </div>
                                    <div class="metric-value">${formatCurrency(semData.total_expected_revenue_cusd || 0)}</div>
                                    <div class="metric-subtitle">Collected: ${formatCurrency(semData.total_paid_cusd || 0)} (${formatPercent(semData.total_paid_percent_cusd || 0)})</div>
                                    <div class="progress-bar">
                                        <div class="progress-fill ${getPerformanceClass(semData.total_paid_percent_cusd || 0)}"
                                             style="width: ${semData.total_paid_percent_cusd || 0}%"></div>
                                    </div>
                                </div>
                                <div class="metric-card cusd">
                                    <div class="metric-header">
                                        <div class="metric-title">Outstanding</div>
                                        <span class="currency-badge cusd">CUSD</span>
                                    </div>
                                    <div class="metric-value">${formatCurrency(semData.total_unpaid_cusd || 0)}</div>
                                    <div class="metric-subtitle">${(100 - (semData.total_paid_percent_cusd || 0)).toFixed(1)}% uncollected</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-header">
                                        <div class="metric-title">Gross Amount (Before FA)</div>
                                    </div>
                                    <div class="metric-value">${formatCurrency(semData.before_fa || 0)}</div>
                                    <div class="metric-subtitle">FA: ${formatCurrency(semData.fa_amounts || 0)}</div>
                                </div>
                            </div>
                            ${semData.total_expected_revenue_lusd > 0 ? `
                            <!-- LBP/LUSD Row -->
                            <div class="currency-row">
                                <div class="metric-card lusd">
                                    <div class="metric-header">
                                        <div class="metric-title">Expected Revenue</div>
                                        <span class="currency-badge lusd">LUSD</span>
                                    </div>
                                    <div class="metric-value">${shouldConvert ? formatLUSD(semData.total_expected_revenue_lusd || 0) : formatCurrency(semData.total_expected_revenue_lusd || 0)}</div>
                                    <div class="metric-subtitle">Collected: ${shouldConvert ? formatLUSD(semData.total_paid_lusd || 0) : formatCurrency(semData.total_paid_lusd || 0)} (${formatPercent(semData.total_paid_percent_lusd || 0)})</div>
                                    ${shouldConvert ? `
                                    <div class="metric-conversion">â‰ˆ ${formatCurrency(convertLUSDtoUSD(semData.total_expected_revenue_lusd || 0, data.year))}</div>
                                    ` : ''}
                                    <div class="progress-bar">
                                        <div class="progress-fill ${getPerformanceClass(semData.total_paid_percent_lusd || 0)}"
                                             style="width: ${semData.total_paid_percent_lusd || 0}%"></div>
                                    </div>
                                </div>
                                <div class="metric-card lusd">
                                    <div class="metric-header">
                                        <div class="metric-title">Outstanding</div>
                                        <span class="currency-badge lusd">LUSD</span>
                                    </div>
                                    <div class="metric-value">${shouldConvert ? formatLUSD(semData.total_unpaid_lusd || 0) : formatCurrency(semData.total_unpaid_lusd || 0)}</div>
                                    <div class="metric-subtitle">${(100 - (semData.total_paid_percent_lusd || 0)).toFixed(1)}% uncollected</div>
                                    ${shouldConvert ? `
                                    <div class="metric-conversion">â‰ˆ ${formatCurrency(convertLUSDtoUSD(semData.total_unpaid_lusd || 0, data.year))}</div>
                                    ` : ''}
                                </div>
                                <div style="grid-column: 3;"></div>
                            </div>
                            <!-- Total Expected Revenue Row -->
                            <div class="currency-row" style="margin-top: 20px;">
                                <div class="metric-card" style="border-left-color: #16a085;">
                                    <div class="metric-header">
                                        <div class="metric-title">Total Expected Revenue</div>
                                        <span class="currency-badge" style="background: #d5f4e6; color: #117a65;">COMBINED</span>
                                    </div>
                                    <div class="metric-value" style="color: #16a085;">${formatCurrency((semData.total_expected_revenue_cusd || 0) + (semData.total_expected_revenue_lusd || 0))}</div>
                                    <div class="metric-subtitle">CUSD + LUSD (nominal)</div>
                                </div>
                                <div class="metric-card" style="border-left-color: #27ae60;">
                                    <div class="metric-header">
                                        <div class="metric-title">Total Expected Revenue (USD Equivalent)</div>
                                        <span class="currency-badge" style="background: #d4efdf; color: #196f3d;">USD</span>
                                    </div>
                                    <div class="metric-value" style="color: #27ae60;">${formatCurrency((semData.total_expected_revenue_cusd || 0) + convertLUSDtoUSD(semData.total_expected_revenue_lusd || 0, data.year))}</div>
                                    <div class="metric-subtitle">CUSD + LUSD converted to USD</div>
                                </div>
                                <div style="grid-column: 3;"></div>
                            </div>
                            ` : ''}

                            <!-- Voucher Breakdown Section -->
                            ${semData.vouchers ? `
                            <div style="margin-top: 30px;">
                                <h3 style="color: #2c3e50; font-size: 1.3rem; margin-bottom: 20px; text-align: center;">ðŸ“‹ Voucher Collection Breakdown</h3>

                                <!-- CUSD Vouchers -->
                                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                                    <h4 style="color: #7b1fa2; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                        <span class="currency-badge cusd">CUSD</span>
                                        <span>Voucher Collections</span>
                                    </h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                        ${semData.vouchers.cusd.map(v => `
                                            <div style="background: white; border-radius: 8px; padding: 15px; border-left: 4px solid ${v.percent >= 25 ? '#27ae60' : v.percent >= 10 ? '#f39c12' : '#e74c3c'};">
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                                    <span style="font-weight: 700; color: #2c3e50; font-size: 1.1rem;">${v.name}</span>
                                                    <span style="font-weight: 700; color: ${v.percent >= 25 ? '#27ae60' : v.percent >= 10 ? '#f39c12' : '#e74c3c'}; font-size: 1.1rem;">${v.percent.toFixed(2)}%</span>
                                                </div>
                                                <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 5px;">Expected: ${formatCurrency(v.expected)}</div>
                                                <div style="font-size: 0.85rem; color: #27ae60; margin-bottom: 5px;">Collected: ${formatCurrency(v.collected)}</div>
                                                <div style="font-size: 0.85rem; color: #e74c3c;">Outstanding: ${formatCurrency(v.outstanding)}</div>
                                                <div class="progress-bar" style="margin-top: 10px;">
                                                    <div class="progress-fill ${getPerformanceClass(v.percent)}" style="width: ${v.percent}%"></div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <!-- LUSD Vouchers -->
                                ${semData.vouchers.lusd ? `
                                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                                    <h4 style="color: #1976d2; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                        <span class="currency-badge lusd">LUSD</span>
                                        <span>Voucher Collections</span>
                                    </h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                        ${semData.vouchers.lusd.map(v => `
                                            <div style="background: white; border-radius: 8px; padding: 15px; border-left: 4px solid ${v.percent >= 25 ? '#27ae60' : v.percent >= 10 ? '#f39c12' : '#e74c3c'};">
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                                    <span style="font-weight: 700; color: #2c3e50; font-size: 1.1rem;">${v.name}</span>
                                                    <span style="font-weight: 700; color: ${v.percent >= 25 ? '#27ae60' : v.percent >= 10 ? '#f39c12' : '#e74c3c'}; font-size: 1.1rem;">${v.percent.toFixed(2)}%</span>
                                                </div>
                                                <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 5px;">Expected: ${shouldConvert ? formatLUSD(v.expected) : formatCurrency(v.expected)}</div>
                                                <div style="font-size: 0.85rem; color: #27ae60; margin-bottom: 5px;">Collected: ${shouldConvert ? formatLUSD(v.collected) : formatCurrency(v.collected)}</div>
                                                <div style="font-size: 0.85rem; color: #e74c3c;">Outstanding: ${shouldConvert ? formatLUSD(v.outstanding) : formatCurrency(v.outstanding)}</div>
                                                ${shouldConvert ? `<div style="font-size: 0.85rem; color: #2980b9; margin-top: 5px;">â‰ˆ ${formatCurrency(convertLUSDtoUSD(v.collected, data.year))} collected</div>` : ''}
                                                <div class="progress-bar" style="margin-top: 10px;">
                                                    <div class="progress-fill ${getPerformanceClass(v.percent)}" style="width: ${v.percent}%"></div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}

                                <!-- Combined Voucher Totals -->
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 20px; margin-top: 20px;">
                                    <h4 style="color: white; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                        <span style="background: white; color: #667eea; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; font-weight: 700;">COMBINED</span>
                                        <span>Total Voucher Collections (CUSD + LUSD)</span>
                                    </h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px;">
                                        ${semData.vouchers.cusd.map((cusdV, index) => {
                                            const lusdV = semData.vouchers.lusd[index];
                                            const totalExpected = cusdV.expected + convertLUSDtoUSD(lusdV.expected, data.year);
                                            const totalCollected = cusdV.collected + convertLUSDtoUSD(lusdV.collected, data.year);
                                            const totalOutstanding = cusdV.outstanding + convertLUSDtoUSD(lusdV.outstanding, data.year);
                                            const totalPercent = (cusdV.percent + lusdV.percent) / 2;

                                            return `
                                            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 18px; border-left: 4px solid ${totalPercent >= 25 ? '#27ae60' : totalPercent >= 10 ? '#f39c12' : '#e74c3c'}; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                                    <span style="font-weight: 700; color: #2c3e50; font-size: 1.2rem;">${cusdV.name} Total</span>
                                                    <span style="font-weight: 700; color: ${totalPercent >= 25 ? '#27ae60' : totalPercent >= 10 ? '#f39c12' : '#e74c3c'}; font-size: 1.2rem;">${totalPercent.toFixed(2)}%</span>
                                                </div>
                                                <div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 6px; font-weight: 600;">Expected: ${formatCurrency(totalExpected)}</div>
                                                <div style="font-size: 0.9rem; color: #27ae60; margin-bottom: 6px; font-weight: 600;">Collected: ${formatCurrency(totalCollected)}</div>
                                                <div style="font-size: 0.9rem; color: #e74c3c; font-weight: 600;">Outstanding: ${formatCurrency(totalOutstanding)}</div>
                                                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ecf0f1;">
                                                    <div style="font-size: 0.8rem; color: #95a5a6;">
                                                        CUSD: ${formatCurrency(cusdV.collected)} (${cusdV.percent.toFixed(1)}%)<br>
                                                        LUSD: ${shouldConvert ? formatLUSD(lusdV.collected) : formatCurrency(lusdV.collected)} (${lusdV.percent.toFixed(1)}%)
                                                    </div>
                                                </div>
                                                <div class="progress-bar" style="margin-top: 12px; height: 8px;">
                                                    <div class="progress-fill ${getPerformanceClass(totalPercent)}" style="width: ${Math.min(totalPercent, 100)}%"></div>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update reserves section
        function updateReserves(reserves) {
            const kpiSection = document.getElementById('reservesKpiSection');
            const prev = reserves.prev_year || null;

            const reserveKpis = [
                {
                    title: 'Total Reserves',
                    value: reserves.total || 0,
                    prevValue: prev ? (prev.total || 0) : null,
                    percentage: null,
                    icon: 'ðŸ’Ž',
                    color: '#2ecc71',
                    months: 'All semesters combined',
                    isTotal: true
                },
                {
                    title: 'Fall Reserves',
                    value: reserves.by_semester.Fall || 0,
                    prevValue: prev ? (prev.by_semester.Fall || 0) : null,
                    percentage: ((reserves.by_semester.Fall / reserves.total) * 100).toFixed(1),
                    icon: 'ðŸ‚',
                    color: '#3498db',
                    months: 'October - January'
                },
                {
                    title: 'Spring Reserves',
                    value: reserves.by_semester.Spring || 0,
                    prevValue: prev ? (prev.by_semester.Spring || 0) : null,
                    percentage: ((reserves.by_semester.Spring / reserves.total) * 100).toFixed(1),
                    icon: 'ðŸŒ¸',
                    color: '#9b59b6',
                    months: 'February - June'
                },
                {
                    title: 'Summer Reserves',
                    value: reserves.by_semester.Summer || 0,
                    prevValue: prev ? (prev.by_semester.Summer || 0) : null,
                    percentage: ((reserves.by_semester.Summer / reserves.total) * 100).toFixed(1),
                    icon: 'â˜€ï¸',
                    color: '#e67e22',
                    months: 'July - September'
                }
            ];

            function buildPrevYearHtml(kpi) {
                if (kpi.prevValue === null) return '';
                const diff = kpi.value - kpi.prevValue;
                const pctChange = kpi.prevValue !== 0 ? ((diff / kpi.prevValue) * 100).toFixed(1) : (kpi.value > 0 ? '100.0' : '0.0');
                const isUp = diff >= 0;
                const arrow = isUp ? 'â–²' : 'â–¼';
                const changeColor = isUp ? '#27ae60' : '#e74c3c';
                return `
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #ecf0f1;">
                        <div style="font-size: 0.8rem; color: #95a5a6; margin-bottom: 4px;">Previous Year</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 1rem; font-weight: 600; color: #7f8c8d;">${formatCurrency(kpi.prevValue)}</span>
                            <span style="font-size: 0.85rem; font-weight: 600; color: ${changeColor};">${arrow} ${Math.abs(pctChange)}%</span>
                        </div>
                    </div>
                `;
            }

            kpiSection.innerHTML = reserveKpis.map(kpi => `
                <div class="kpi-card" style="border-color: ${kpi.color};">
                    <div class="kpi-header">
                        <div class="kpi-title">${kpi.title}</div>
                        <div class="kpi-icon" style="background: ${kpi.color};">${kpi.icon}</div>
                    </div>
                    <div class="kpi-value" style="color: ${kpi.color};">${formatCurrency(kpi.value)}</div>
                    <div class="kpi-change">${kpi.months}</div>
                    ${!kpi.isTotal ? `
                    <div class="progress-bar" style="margin-top: 15px;">
                        <div class="progress-fill" style="width: ${kpi.percentage}%; background: ${kpi.color};"></div>
                    </div>
                    <div style="text-align: right; margin-top: 5px; font-size: 0.85rem; color: #7f8c8d;">${kpi.percentage}% of total reserves</div>
                    ` : ''}
                    ${buildPrevYearHtml(kpi)}
                </div>
            `).join('');

            // Build monthly comparison table
            const compDiv = document.getElementById('reservesMonthlyComparison');
            if (prev && reserves.monthly && reserves.monthly.length > 0) {
                const monthOrder = ['October','November','December','January','February','March','April','May','June','July','August','September'];
                const semesterOf = m => ({'October':'Fall','November':'Fall','December':'Fall','January':'Fall','February':'Spring','March':'Spring','April':'Spring','May':'Spring','June':'Spring','July':'Summer','August':'Summer','September':'Summer'}[m] || '');
                const semesterColor = s => ({'Fall':'#3498db','Spring':'#9b59b6','Summer':'#e67e22'}[s] || '#7f8c8d');

                // Build lookup for previous year by month
                const prevByMonth = {};
                (prev.monthly || []).forEach(m => { prevByMonth[m.month] = m.amount; });

                // Only show months that exist in current year
                const currentMonths = reserves.monthly.map(m => m.month);
                const orderedMonths = monthOrder.filter(m => currentMonths.includes(m));

                let rows = orderedMonths.map(month => {
                    const curr = reserves.monthly.find(m => m.month === month);
                    const currVal = curr ? curr.amount : 0;
                    const prevVal = prevByMonth[month] || 0;
                    const diff = currVal - prevVal;
                    const pctChange = prevVal !== 0 ? ((diff / prevVal) * 100).toFixed(1) : (currVal > 0 ? 'N/A' : '0.0');
                    const isUp = diff >= 0;
                    const arrow = isUp ? 'â–²' : 'â–¼';
                    const changeColor = isUp ? '#27ae60' : '#e74c3c';
                    const sem = semesterOf(month);
                    const sColor = semesterColor(sem);

                    return `<tr>
                        <td style="padding: 12px 16px; font-weight: 600; color: #2c3e50; border-bottom: 1px solid #ecf0f1;">
                            <span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${sColor}; margin-right: 8px;"></span>${month}
                        </td>
                        <td style="padding: 12px 16px; text-align: right; font-weight: 600; color: #2c3e50; border-bottom: 1px solid #ecf0f1;">${formatCurrency(currVal)}</td>
                        <td style="padding: 12px 16px; text-align: right; color: #7f8c8d; border-bottom: 1px solid #ecf0f1;">${formatCurrency(prevVal)}</td>
                        <td style="padding: 12px 16px; text-align: right; font-weight: 600; color: ${changeColor}; border-bottom: 1px solid #ecf0f1;">
                            ${pctChange === 'N/A' ? 'N/A' : arrow + ' ' + Math.abs(pctChange) + '%'}
                        </td>
                    </tr>`;
                }).join('');

                // Totals row using only the months that exist in current year
                const currTotal = orderedMonths.reduce((s, m) => { const c = reserves.monthly.find(x => x.month === m); return s + (c ? c.amount : 0); }, 0);
                const prevTotal = orderedMonths.reduce((s, m) => s + (prevByMonth[m] || 0), 0);
                const totalDiff = currTotal - prevTotal;
                const totalPct = prevTotal !== 0 ? ((totalDiff / prevTotal) * 100).toFixed(1) : 'N/A';
                const totalUp = totalDiff >= 0;
                const totalArrow = totalUp ? 'â–²' : 'â–¼';
                const totalColor = totalUp ? '#27ae60' : '#e74c3c';

                compDiv.innerHTML = `
                    <div style="max-width: 800px; margin: 0 auto 50px auto; background: white; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden;">
                        <div style="padding: 20px 24px; background: linear-gradient(135deg, #2c3e50, #34495e); color: white;">
                            <h3 style="margin: 0; font-size: 1.2rem;">Monthly Reserves Comparison</h3>
                            <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.8;">Current year vs. previous year (same months)</p>
                        </div>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px 16px; text-align: left; font-size: 0.8rem; text-transform: uppercase; color: #7f8c8d; letter-spacing: 0.5px;">Month</th>
                                    <th style="padding: 12px 16px; text-align: right; font-size: 0.8rem; text-transform: uppercase; color: #7f8c8d; letter-spacing: 0.5px;">Current Year</th>
                                    <th style="padding: 12px 16px; text-align: right; font-size: 0.8rem; text-transform: uppercase; color: #7f8c8d; letter-spacing: 0.5px;">Previous Year</th>
                                    <th style="padding: 12px 16px; text-align: right; font-size: 0.8rem; text-transform: uppercase; color: #7f8c8d; letter-spacing: 0.5px;">Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows}
                                <tr style="background: #f8f9fa; font-weight: 700;">
                                    <td style="padding: 14px 16px; color: #2c3e50; border-top: 2px solid #2c3e50;">Total</td>
                                    <td style="padding: 14px 16px; text-align: right; color: #2c3e50; border-top: 2px solid #2c3e50;">${formatCurrency(currTotal)}</td>
                                    <td style="padding: 14px 16px; text-align: right; color: #7f8c8d; border-top: 2px solid #2c3e50;">${formatCurrency(prevTotal)}</td>
                                    <td style="padding: 14px 16px; text-align: right; color: ${totalColor}; border-top: 2px solid #2c3e50;">
                                        ${totalPct === 'N/A' ? 'N/A' : totalArrow + ' ' + Math.abs(totalPct) + '%'}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
                compDiv.style.display = 'block';
            } else {
                compDiv.style.display = 'none';
            }
        }

        // Update charts
        function updateCharts(data) {
            const chartsSection = document.getElementById('chartsSection');

            // Clear existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            // Create chart containers
            let chartHTML = `
                <div class="chart-card">
                    <h3 class="chart-title">Collection Performance by Semester</h3>
                    <div class="chart-container">
                        <canvas id="collectionPerformanceChart"></canvas>
                    </div>
                </div>
            `;

            // Only add expense chart for 2024-2025
            if (data.year === '2024-2025' && data.expenses && data.expenses.top_categories && data.expenses.top_categories.length > 0) {
                chartHTML += `
                    <div class="chart-card">
                        <h3 class="chart-title">Top Expense Categories</h3>
                        <div class="chart-container">
                            <canvas id="expenseCategoriesChart"></canvas>
                        </div>
                    </div>
                `;
            }

            chartsSection.innerHTML = chartHTML;

            // Create charts
            createCollectionPerformanceChart(data);

            // Only create expense chart for 2024-2025
            if (data.year === '2024-2025' && data.expenses && data.expenses.top_categories && data.expenses.top_categories.length > 0) {
                createExpenseCategoriesChart(data);
            }
        }

        // Create collection performance chart
        function createCollectionPerformanceChart(data) {
            const ctx = document.getElementById('collectionPerformanceChart').getContext('2d');
            const semesters = Object.keys(data.semesters);
            const shouldConvert = shouldConvertLUSD(data.year);

            // Check if any semester has LUSD data
            const hasLUSDData = Object.values(data.semesters).some(s =>
                s.total_expected_revenue_lusd && s.total_expected_revenue_lusd > 0
            );

            // For years with conversion (2024-2025, 2025-2026), combine totals
            // For other years, show separate CUSD and LUSD collection rates if both exist
            if (!shouldConvert && hasLUSDData) {
                // Show separate bars for CUSD and LUSD
                charts.collection = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: semesters.map(s => s.split('_')[0]),
                        datasets: [
                            {
                                label: 'CUSD Collection Rate %',
                                data: semesters.map(sem => {
                                    const semData = data.semesters[sem];
                                    return semData.total_paid_percent_cusd || 0;
                                }),
                                backgroundColor: '#3498db',
                                borderWidth: 0
                            },
                            {
                                label: 'LUSD Collection Rate %',
                                data: semesters.map(sem => {
                                    const semData = data.semesters[sem];
                                    return semData.total_paid_percent_lusd || 0;
                                }),
                                backgroundColor: '#9b59b6',
                                borderWidth: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            datalabels: {
                                anchor: 'center',
                                align: 'center',
                                formatter: (value) => value > 0 ? value.toFixed(1) + '%' : '',
                                color: 'white',
                                font: { weight: 'bold', size: 12 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: (value) => value + '%'
                                }
                            }
                        }
                    }
                });
            } else {
                // For 2024-2025, 2025-2026 (with conversion), or years with only CUSD data
                charts.collection = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: semesters.map(s => s.split('_')[0]),
                        datasets: [{
                            label: 'Collection Rate %',
                            data: semesters.map(sem => {
                                const semData = data.semesters[sem];
                                if (shouldConvert && hasLUSDData) {
                                    // Convert LUSD to USD for 2024-2025 and 2025-2026
                                    const totalExpected = (semData.total_expected_revenue_cusd || 0) +
                                                        convertLUSDtoUSD(semData.total_expected_revenue_lusd || 0, data.year);
                                    const totalPaid = (semData.total_paid_cusd || 0) +
                                                    convertLUSDtoUSD(semData.total_paid_lusd || 0, data.year);
                                    return totalExpected > 0 ? (totalPaid / totalExpected * 100) : 0;
                                } else {
                                    // Just use CUSD for years with no LUSD data or when not converting
                                    return semData.total_paid_percent_cusd || 0;
                                }
                            }),
                            backgroundColor: function(context) {
                                const value = context.parsed.y;
                                if (value >= 75) return '#27ae60';
                                if (value >= 50) return '#f39c12';
                                return '#e74c3c';
                            },
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                anchor: 'center',
                                align: 'center',
                                formatter: (value) => value.toFixed(1) + '%',
                                color: 'white',
                                font: { weight: 'bold', size: 14 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: (value) => value + '%'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Create expense categories chart
        function createExpenseCategoriesChart(data) {
            const ctx = document.getElementById('expenseCategoriesChart').getContext('2d');
            const categories = data.expenses.top_categories;
            const total = categories.reduce((sum, cat) => sum + cat[1], 0);

            charts.expenses = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories.map(cat => cat[0]),
                    datasets: [{
                        data: categories.map(cat => cat[1]),
                        backgroundColor: ['#e74c3c', '#f39c12', '#9b59b6', '#e67e22', '#3498db', '#1abc9c', '#95a5a6'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 15,
                                font: { size: 11 }
                            }
                        },
                        datalabels: {
                            formatter: (value, context) => {
                                const percentage = (value / total * 100).toFixed(1);
                                return percentage > 5 ? percentage + '%' : '';
                            },
                            color: 'white',
                            font: { weight: 'bold', size: 12 }
                        }
                    }
                }
            });
        }

        // Update trend graphs showing metrics over all years
        function updateTrendGraphs() {
            const graphsSection = document.getElementById('graphsSection');

            // Collect data from all years
            const years = Object.keys(HARDCODED_DATA).sort();
            const grossBeforeFA = [];
            const financialAid = [];
            const grossRevenue = [];
            const netRevenue = [];
            const collections = [];
            const outstanding = [];
            const fallStudents = [];

            years.forEach(year => {
                const yearData = HARDCODED_DATA[year];
                grossBeforeFA.push(yearData.totals.gross_before_fa || 0);
                financialAid.push(yearData.totals.financial_aid || 0);
                grossRevenue.push(yearData.totals.gross_after_fa || 0);
                netRevenue.push(yearData.totals.net_revenue || 0);
                collections.push(yearData.totals.collections || 0);
                outstanding.push(yearData.totals.outstanding || 0);

                // Find Fall semester data for student count
                const fallSem = Object.keys(yearData.semesters).find(s => s.includes('Fall'));
                if (fallSem && yearData.semesters[fallSem]) {
                    fallStudents.push(yearData.semesters[fallSem].students || 0);
                } else {
                    fallStudents.push(0);
                }
            });

            // Clear existing trend charts
            if (charts.trendCharts) {
                Object.values(charts.trendCharts).forEach(chart => {
                    if (chart) chart.destroy();
                });
            }
            charts.trendCharts = {};

            // Create chart containers
            graphsSection.innerHTML = `
                <div class="chart-card">
                    <h3 class="chart-title">Gross Amount & Financial Aid Trends</h3>
                    <div class="chart-container">
                        <canvas id="grossFATrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Net Revenue & Collections Trends</h3>
                    <div class="chart-container">
                        <canvas id="revenueCollectionsTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Outstanding Amount Trend</h3>
                    <div class="chart-container">
                        <canvas id="outstandingTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Fall Semester Student Enrollment</h3>
                    <div class="chart-container">
                        <canvas id="studentsTrendChart"></canvas>
                    </div>
                </div>
            `;

            // Create Gross Amount & Financial Aid chart
            const ctx1 = document.getElementById('grossFATrendChart').getContext('2d');
            charts.trendCharts.grossFA = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Gross Amount (Before FA)',
                            data: grossBeforeFA,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            tension: 0.2
                        },
                        {
                            label: 'Financial Aid',
                            data: financialAid,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 3,
                            tension: 0.2
                        },
                        {
                            label: 'Gross Revenue (After FA)',
                            data: grossRevenue,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            borderWidth: 3,
                            tension: 0.2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000000).toFixed(0) + 'M';
                                }
                            }
                        }
                    }
                }
            });

            // Create Net Revenue & Collections chart
            const ctx2 = document.getElementById('revenueCollectionsTrendChart').getContext('2d');
            charts.trendCharts.revenueCollections = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Net Revenue',
                            data: netRevenue,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            borderWidth: 3,
                            tension: 0.2
                        },
                        {
                            label: 'Collections',
                            data: collections,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            borderWidth: 3,
                            tension: 0.2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000000).toFixed(0) + 'M';
                                }
                            }
                        }
                    }
                }
            });

            // Create Outstanding Amount chart
            const ctx3 = document.getElementById('outstandingTrendChart').getContext('2d');
            charts.trendCharts.outstanding = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Outstanding Amount',
                        data: outstanding,
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        borderWidth: 3,
                        tension: 0.2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });

            // Create Student Enrollment chart
            const ctx4 = document.getElementById('studentsTrendChart').getContext('2d');
            charts.trendCharts.students = new Chart(ctx4, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Fall Semester Students',
                        data: fallStudents,
                        borderColor: '#16a085',
                        backgroundColor: 'rgba(22, 160, 133, 0.1)',
                        borderWidth: 3,
                        tension: 0.2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        datalabels: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update summary table
        function updateSummaryTable(data) {
            const table = document.getElementById('summaryTable');

            const actualNetRevenue = calculateActualNetRevenue(data);
            const surplus = data.totals.collections - data.totals.expenses;
            const expectedSurplus = actualNetRevenue - data.totals.expenses;

            table.innerHTML = `
                <tr>
                    <td><strong>Academic Year</strong></td>
                    <td class="number"><strong>${data.year}</strong></td>
                </tr>
                <tr>
                    <td><strong>Total Gross Amount (Before FA)</strong></td>
                    <td class="number"><strong>${formatCurrency(data.totals.gross_before_fa)}</strong></td>
                </tr>
                <tr>
                    <td>Financial Aid Distributed</td>
                    <td class="number negative">-${formatCurrency(data.totals.financial_aid)}</td>
                </tr>
                <tr style="background-color: #e8f5e8;">
                    <td><strong>Net Revenue (USD Equivalent)</strong></td>
                    <td class="number"><strong>${formatCurrency(actualNetRevenue)}</strong></td>
                </tr>
                <tr>
                    <td>Operating Expenses</td>
                    <td class="number negative">-${formatCurrency(data.totals.expenses)}</td>
                </tr>
                <tr style="background-color: #d4edda;">
                    <td><strong>Expected Operating Result</strong></td>
                    <td class="number ${expectedSurplus >= 0 ? 'positive' : 'negative'}">
                        <strong>${expectedSurplus >= 0 ? '+' : '-'}${formatCurrency(Math.abs(expectedSurplus))}</strong>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="padding-top: 20px;"><strong>Cash Position Analysis</strong></td>
                </tr>
                <tr>
                    <td>Total Collections to Date</td>
                    <td class="number">${formatCurrency(data.totals.collections)}</td>
                </tr>
                <tr>
                    <td>Operating Expenses</td>
                    <td class="number negative">-${formatCurrency(data.totals.expenses)}</td>
                </tr>
                <tr style="background-color: #d4edda;">
                    <td><strong>Cash Operating Result</strong></td>
                    <td class="number ${surplus >= 0 ? 'positive' : 'negative'}">
                        <strong>${surplus >= 0 ? '+' : '-'}${formatCurrency(Math.abs(surplus))}</strong>
                    </td>
                </tr>
            `;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeYearSelector();

            // Auto-select 2025-2026 as the default year
            const defaultYear = '2025-2026';
            if (HARDCODED_DATA[defaultYear]) {
                selectYear(defaultYear);
            } else {
                // Fallback to the most recent year if 2025-2026 doesn't exist
                const years = Object.keys(HARDCODED_DATA).sort();
                const mostRecentYear = years[years.length - 1];
                selectYear(mostRecentYear);
            }
        });
    </script>
</body>
</html>